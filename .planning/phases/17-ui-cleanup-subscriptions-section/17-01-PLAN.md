---
phase: 17-ui-cleanup-subscriptions-section
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/dashboard/src/components/user-menu.tsx
  - apps/dashboard/src/components/navbar.tsx
  - apps/dashboard/src/components/archive/wallet-dropdown.tsx
autonomous: true

must_haves:
  truths:
    - "User sees header without embedded wallet balance or address display"
    - "User sees user icon with dropdown menu in header"
    - "User can access Dashboard, Subscriptions, and Rewards from user menu"
    - "User can sign out from user menu"
  artifacts:
    - path: "apps/dashboard/src/components/user-menu.tsx"
      provides: "User menu dropdown component"
      exports: ["UserMenu"]
    - path: "apps/dashboard/src/components/archive/wallet-dropdown.tsx"
      provides: "Archived wallet dropdown (preserved for Phase 18)"
    - path: "apps/dashboard/src/components/navbar.tsx"
      provides: "Updated header using UserMenu instead of WalletDropdown"
  key_links:
    - from: "apps/dashboard/src/components/navbar.tsx"
      to: "apps/dashboard/src/components/user-menu.tsx"
      via: "import { UserMenu }"
      pattern: "import.*UserMenu.*from.*user-menu"
    - from: "apps/dashboard/src/components/user-menu.tsx"
      to: "/subscriptions"
      via: "Link component"
      pattern: "href=.*subscriptions"
---

<objective>
Replace legacy WalletDropdown in header with a clean UserMenu dropdown.

Purpose: Users should see a simple user icon + dropdown menu instead of wallet balance/address in the header. The wallet functionality moves to the new Subscriptions page (Plan 02).

Output: UserMenu component with Dashboard/Subscriptions/Rewards links and sign out, WalletDropdown archived to /archive folder, navbar updated.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/17-ui-cleanup-subscriptions-section/17-CONTEXT.md
@.planning/phases/17-ui-cleanup-subscriptions-section/17-RESEARCH.md
@apps/dashboard/src/components/navbar.tsx
@apps/dashboard/src/components/wallet-dropdown.tsx
@apps/dashboard/src/components/ui/dropdown-menu.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Archive WalletDropdown component</name>
  <files>
    apps/dashboard/src/components/archive/wallet-dropdown.tsx
  </files>
  <action>
Create archive folder and move wallet-dropdown.tsx there:

1. Create `apps/dashboard/src/components/archive/` directory
2. Move `wallet-dropdown.tsx` to `archive/wallet-dropdown.tsx`
3. Add a comment at the top of the archived file:
   ```typescript
   /**
    * ARCHIVED: 2026-01-22
    * Reason: Legacy embedded wallet UI removed from header in Phase 17
    * Note: Preserved for reference - wallet functionality moves to Subscriptions page
    * See: Phase 18 will implement multi-chain wallets in Subscriptions section
    */
   ```

Do NOT delete the file - users may have funds in Solana wallet. This preserves the code for Phase 18.
  </action>
  <verify>
    - File exists at `apps/dashboard/src/components/archive/wallet-dropdown.tsx`
    - Original location `apps/dashboard/src/components/wallet-dropdown.tsx` no longer exists
    - Archive comment is present at top of file
  </verify>
  <done>WalletDropdown archived with preservation note, original removed</done>
</task>

<task type="auto">
  <name>Task 2: Create UserMenu component</name>
  <files>
    apps/dashboard/src/components/user-menu.tsx
  </files>
  <action>
Create a new UserMenu component that replaces WalletDropdown:

```typescript
'use client';

import Link from 'next/link';
import { usePathname } from 'next/navigation';
import { User, LogOut, LayoutDashboard, CreditCard, Trophy, ChevronDown } from 'lucide-react';
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuTrigger,
} from '@/components/ui/dropdown-menu';
import { useAuth } from '@/components/auth/auth-provider';

export function UserMenu() {
  const pathname = usePathname();
  const { user, signOut, hasClaimable } = useAuth();
  const isOnDashboard = pathname === '/dashboard';

  return (
    <DropdownMenu modal={false}>
      <DropdownMenuTrigger asChild>
        <button className="flex items-center gap-1 text-sm text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-100 focus:outline-none transition-colors">
          <User className="w-5 h-5" />
          <ChevronDown className="w-3 h-3" />
        </button>
      </DropdownMenuTrigger>
      <DropdownMenuContent align="end" className="w-56">
        <DropdownMenuLabel className="font-normal">
          <p className="text-sm font-medium truncate">{user?.email}</p>
        </DropdownMenuLabel>
        <DropdownMenuSeparator />
        {!isOnDashboard && (
          <DropdownMenuItem asChild>
            <Link href="/dashboard" className="flex items-center cursor-pointer">
              <LayoutDashboard className="w-4 h-4 mr-2" />
              Dashboard
            </Link>
          </DropdownMenuItem>
        )}
        <DropdownMenuItem asChild>
          <Link href="/subscriptions" className="flex items-center cursor-pointer">
            <CreditCard className="w-4 h-4 mr-2" />
            Subscriptions
          </Link>
        </DropdownMenuItem>
        <DropdownMenuItem asChild>
          <Link href="/rewards" className="flex items-center cursor-pointer relative">
            <Trophy className="w-4 h-4 mr-2" />
            Rewards
            {hasClaimable && (
              <span className="absolute right-2 w-2 h-2 bg-green-500 rounded-full animate-pulse" />
            )}
          </Link>
        </DropdownMenuItem>
        <DropdownMenuSeparator />
        <DropdownMenuItem onClick={signOut} className="cursor-pointer">
          <LogOut className="w-4 h-4 mr-2" />
          Sign out
        </DropdownMenuItem>
      </DropdownMenuContent>
    </DropdownMenu>
  );
}
```

Key differences from WalletDropdown:
- No wallet balance display in trigger (just user icon + chevron)
- No billing wallet section
- Added Subscriptions link with CreditCard icon
- Simpler, cleaner structure
- Keeps Rewards link with claimable indicator
  </action>
  <verify>
    - File exists at `apps/dashboard/src/components/user-menu.tsx`
    - Component exports UserMenu function
    - Has links to /dashboard, /subscriptions, /rewards
    - Has sign out functionality
    - No wallet balance or address display
  </verify>
  <done>UserMenu component created with Dashboard/Subscriptions/Rewards links and sign out</done>
</task>

<task type="auto">
  <name>Task 3: Update navbar to use UserMenu</name>
  <files>
    apps/dashboard/src/components/navbar.tsx
  </files>
  <action>
Update navbar.tsx to replace WalletDropdown with UserMenu in BOTH desktop and mobile sections:

1. Change import from WalletDropdown to UserMenu:
   ```typescript
   // Remove: import { WalletDropdown } from '@/components/wallet-dropdown';
   import { UserMenu } from '@/components/user-menu';
   ```

2. Remove the billingWallet query (no longer needed in header):
   ```typescript
   // Remove this entire query block - wallet info no longer displayed in header
   ```

3. Update desktop nav section (around line 123-130):
   ```typescript
   {isAuthenticated ? (
     <div className="flex items-center gap-2">
       {isAdmin && (
         <span className="text-xs px-2 py-0.5 rounded bg-muted text-muted-foreground font-medium">
           Admin
         </span>
       )}
       <UserMenu />
     </div>
   ) : (
   ```

4. Update mobile menu section (around line 189-196):
   ```typescript
   {isAuthenticated ? (
     <div className="px-3 py-3">
       <div className="flex items-center gap-2">
         {isAdmin && (
           <span className="text-xs px-2 py-0.5 rounded bg-muted text-muted-foreground font-medium">
             Admin
           </span>
         )}
         <UserMenu />
       </div>
     </div>
   ) : (
   ```

5. Also remove any unused imports that were only needed for WalletDropdown (if any).
  </action>
  <verify>
    - `npm run build` in apps/dashboard succeeds
    - No references to WalletDropdown in navbar.tsx
    - UserMenu imported and used in both desktop and mobile sections
    - No billingWallet query in navbar
  </verify>
  <done>Navbar updated to use UserMenu in both desktop and mobile views, no wallet display in header</done>
</task>

</tasks>

<verification>
Run from apps/dashboard:
```bash
cd apps/dashboard && npm run build
```

Visual verification (after dev server running):
1. Visit any authenticated page
2. Confirm header shows user icon + chevron (not wallet balance)
3. Click user icon - dropdown shows Dashboard, Subscriptions, Rewards, Sign out
4. Confirm no wallet balance/address visible anywhere in header
5. Test on mobile viewport - same behavior
</verification>

<success_criteria>
- WalletDropdown archived to components/archive/ with preservation note
- UserMenu component created with clean dropdown menu
- Navbar uses UserMenu in both desktop and mobile sections
- No wallet balance or address visible in header
- Build succeeds without errors
- Links to /subscriptions route added (page created in Plan 02)
</success_criteria>

<output>
After completion, create `.planning/phases/17-ui-cleanup-subscriptions-section/17-01-SUMMARY.md`
</output>
